   SELECT
       'PENDENTE' AS DES_TIPO,
       A1.A1_COD AS COD_CLIENTE,
       A1.A1_LOJA AS COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       CASE WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC
         ELSE '00010101' END AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGMENTO,
       CONCAT(A1.A1_SATIV3 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
       CONCAT(A1.A1_GRPVEN , '-' , ISNULL((SELECT DISTINCT (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD , A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
       CONCAT(A1.A1_VEND , '-' , A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 , '-' , A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 , '-' , A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN , '-' , A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER , '-' , A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT DISTINCT X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD , A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,
       (
		CASE	WHEN TRIM(C5.C5_FILIAL) = '01' THEN 'RS'
				WHEN TRIM(C5.C5_FILIAL) = '02' THEN 'MG'
				WHEN TRIM(C5.C5_FILIAL) = '03' THEN 'PR'
				WHEN TRIM(C5.C5_FILIAL) = '04' THEN 'SC'
				ELSE 'XX' END) AS COD_FILIAL,
       C6.C6_PRODUTO AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       C6.C6_CF AS DES_CFOP,
       C5.C5_NUM AS NUM_PEDIDO,
       (CASE WHEN C5.C5_PROPRI = '4' THEN 'VENDEDOR'
		ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       convert(varchar, GETDATE(), 103) AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       ' ' AS NUM_NF,
       C5.C5_VEND1 AS COD_VEND_NF,
       CONCAT(C5.C5_VEND1 , '-' , A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN , '-' , A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER , '-' , A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN , '-' , A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER , '-' , A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       CONCAT(A33.A3_GEREN , '-' , A311.A3_NREDUZ) AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER , '-' , A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,
       NULL AS QTD_CLI_FATURADO,
       0 AS QTD_FATURADO,
       0 AS QTD_LITROS_FATURADO,
       0 AS VLR_TABELA,
       0 AS VLR_FATURADO,
       0 AS VLR_TOT_FATURADO,
       0 AS QTD_BONIFICADO,
       0 AS QTD_LITROS_BONIFICADO,
       0 AS VLR_TOT_BONIFICADO,
       0 AS QTD_DEVOLVIDO,
       0 AS QTD_LITROS_DEVOLVIDO,
       0 AS VLR_TOT_DEVOLVIDO,
       0 AS VLR_MARGEM,
       0 AS VLR_MARGEM_PROD,
       0 AS VLR_MARGEM_PERC,
       0 AS VLR_TAMPA,
       0 AS VLR_FI,
       0 AS VLR_CMV,
       0 AS VLR_PIS,
       0 AS VLR_COFINS,
       0 AS VLR_ICM,
       0 AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       0 AS VLR_VENDIDO,
       0 AS QTD_VENDIDO,
       0 AS QTD_LITROS_VENDIDO,
       0 AS VLR_RESIDUO,
       0 AS QTD_RESIDUO,
       0 AS QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       0 AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
       0 AS QTD_LITROS_VEND_DIA,
       0 AS VLR_VEND_DIA,
       (C6.C6_QTDVEN - C6.C6_QTDENT) * C6.C6_PRCVEN AS VLR_PENDENTE,
       (C6.C6_QTDVEN - C6.C6_QTDENT) AS QTD_PENDENTE,
       (C6.C6_QTDVEN - C6.C6_QTDENT) * B1.B1_QTELITS AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SC5140 C5

  INNER JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_COD = C5.C5_CLIENTE
   AND A1.A1_LOJA = C5.C5_LOJACLI
   AND A1.D_E_L_E_T_ = ' '
  

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SC6140 C6
    ON C6.C6_NUM = C5.C5_NUM
   AND C6.C6_FILIAL = C5.C5_FILIAL
   AND C6.C6_CF NOT IN ('6933')
   AND C6.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'S'
   AND F4.F4_CODIGO = C6.C6_TES
   AND F4.F4_FILIAL = C5.C5_FILIAL
   AND F4.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = C6.C6_PRODUTO
   AND B1.B1_FILIAL = C5.C5_FILIAL
   AND C6.C6_BLQ != 'R'
   AND (C6.C6_QTDVEN - C6.C6_QTDENT) > 0
   AND B1.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = C5.C5_CONDPAG
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = C5.C5_VEND1
   AND A34.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR
   AND A3ASUP.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A311
    ON A311.A3_FILIAL = ' '
   AND A311.A3_COD = A33.A3_GEREN
   AND A311.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''
 
 WHERE C5.C5_FILIAL IN ('01','02','03','04')
    AND C5.C5_TIPO = 'N'
    AND C5.C5_EMISSAO >=  convert(varchar, GETDATE()-120, 112) 
    AND C5.D_E_L_E_T_ = ' '

UNION ALL


   SELECT
       'VENDA' AS DES_TIPO,
       A1.A1_COD AS COD_CLIENTE,
       A1.A1_LOJA AS COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       CASE WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC 
         ELSE '00010101'END AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '
                                     ),
                                  ' ')) AS DES_SEGMENTO,
       CONCAT(A1.A1_SATIV3 , '-' , ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' ' ),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 , '-' , ISNULL((SELECT DISTINCT  (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 , '-' , ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
                                  
       CONCAT(A1.A1_GRPVEN , '-' , ISNULL((SELECT DISTINCT  (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD , A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
       CONCAT(A1.A1_VEND , '-' , A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 , '-' , A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 , '-' , A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN , '-' , A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER , '-' , A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT  DISTINCT X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = C5.C5_FILIAL AND X5.D_E_L_E_T_= ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD , A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,
       (CASE WHEN 
				TRIM(C5.C5_FILIAL) = '01' THEN 'RS'
				WHEN TRIM(C5.C5_FILIAL) = '02' THEN 'MG'
				WHEN TRIM(C5.C5_FILIAL) = '03' THEN 'PR'
				WHEN TRIM(C5.C5_FILIAL) = '04' THEN 'SC'
				ELSE 'XX' END) AS COD_FILIAL,
       C6.C6_PRODUTO AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       C6.C6_CF AS DES_CFOP,
       C5.C5_NUM AS NUM_PEDIDO,
       (CASE WHEN 
		C5.C5_PROPRI = '4' THEN 'VENDEDOR'
		ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       CASE WHEN C5.C5_EMISSAO > ' ' THEN C5.C5_EMISSAO
         ELSE '00010101' END AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       ' ' AS NUM_NF,
       C5.C5_VEND1 AS COD_VEND_NF,
       CONCAT(C5.C5_VEND1 , '-' , A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN , '-' , A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER , '-' , A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN , '-' , A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER , '-' , A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       CONCAT(A33.A3_GEREN , '-' , A311.A3_NREDUZ) AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER , '-' , A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,
       NULL AS QTD_CLI_FATURADO,
       0 AS QTD_FATURADO,
       0 AS QTD_LITROS_FATURADO,
       0 AS VLR_TABELA,
       0 AS VLR_FATURADO,
       0 AS VLR_TOT_FATURADO,
       0 AS QTD_BONIFICADO,
       0 AS QTD_LITROS_BONIFICADO,
       0 AS VLR_TOT_BONIFICADO,
       0 AS QTD_DEVOLVIDO,
       0 AS QTD_LITROS_DEVOLVIDO,
       0 AS VLR_TOT_DEVOLVIDO,
       0 AS VLR_MARGEM,
       0 AS VLR_MARGEM_PROD,
       0 AS VLR_MARGEM_PERC,
       0 AS VLR_TAMPA,
       0 AS VLR_FI,
       0 AS VLR_CMV,
       0 AS VLR_PIS,
       0 AS VLR_COFINS,
       0 AS VLR_ICM,
       0 AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       C6_VALOR AS VLR_VENDIDO,
       C6_QTDVEN AS QTD_VENDIDO,
       C6_QTDVEN * B1_QTELITS AS QTD_LITROS_VENDIDO,
       CASE
         WHEN C6_BLQ = 'R' THEN
          (C6_QTDVEN - C6_QTDENT) * C6_PRCVEN
         ELSE
          0
       END VLR_RESIDUO,
       CASE
         WHEN C6_BLQ = 'R' THEN
          C6_QTDVEN - C6_QTDENT
         ELSE
          0
       END QTD_RESIDUO,
       CASE
         WHEN C6_BLQ = 'R' THEN
          (C6_QTDVEN - C6_QTDENT) * B1_QTELITS
         ELSE
          0
       END QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       0 AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
       CASE
         WHEN TRIM(C5.C5_EMISSAO) = convert(varchar, GETDATE(), 112) AND
              B1.B1_CABO != 'MIC' THEN
          C6_QTDVEN * B1_QTELITS
         WHEN TRIM(C5.C5_EMISSAO) = convert(varchar, GETDATE(), 112) AND
              B1.B1_CABO = 'MIC' THEN
          C6_QTDVEN
         ELSE
          0
       END AS QTD_LITROS_VEND_DIA,
       CASE
         WHEN TRIM(C5.C5_EMISSAO) = convert(varchar, GETDATE(), 112) THEN
          C6_VALOR
         ELSE
          0
       END AS VLR_VEND_DIA,
       0 AS VLR_PENDENTE,
       0 AS QTD_PENDENTE,
       0 AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SC5140 C5

  INNER JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_COD = C5.C5_CLIENTE
   AND A1.A1_LOJA = C5.C5_LOJACLI
   AND A1.D_E_L_E_T_ = ' '
   

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SC6140 C6
    ON C6.C6_NUM = C5.C5_NUM
   AND C6.C6_FILIAL = C5.C5_FILIAL
   AND C6.C6_CF NOT IN ('6933')
   AND C6.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'S'
   AND F4.F4_CODIGO = C6.C6_TES
   AND F4.F4_FILIAL = C5.C5_FILIAL
   AND F4.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = C6.C6_PRODUTO
   AND B1.B1_FILIAL = C5.C5_FILIAL
   AND B1.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = C5.C5_CONDPAG
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = C5.C5_VEND1
   AND A34.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR
   AND A3ASUP.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A311
    ON A311.A3_FILIAL = ' '
   AND A311.A3_COD = A33.A3_GEREN
   AND A311.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_ = ' '
   
  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''


 WHERE C5.C5_FILIAL IN ('01','02','03','04')
    AND C5.C5_TIPO = 'N'
    AND C5.C5_EMISSAO >= convert(varchar, GETDATE()-1095, 112)
    AND C5.D_E_L_E_T_ = ' '

UNION ALL


  SELECT 
      'DEVOLUCAO_BONIFICACAO' AS DES_TIPO,
       F2.F2_CLIENTE AS COD_CLIENTE,
       F2.F2_LOJA AS COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       CASE
         WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC
         ELSE '00010101' END AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL  AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGMENTO,
      CONCAT(A1.A1_SATIV3 , '-' , ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL  AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 , '-' , ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL  AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 , '-' , ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL  AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
       CONCAT(A1.A1_GRPVEN , '-' , ISNULL((SELECT  DISTINCT (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD , A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
      CONCAT(A1.A1_VEND , '-' , A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 , '-' , A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 , '-' , A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN , '-' , A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER , '-' , A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT  DISTINCT X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = D2.D2_FILIAL  AND X5.D_E_L_E_T_  = ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD , A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,
       (CASE WHEN	
			TRIM(D1.D1_FILIAL) = '01' THEN 'RS'
			WHEN TRIM(D1.D1_FILIAL) = '02' THEN 'MG'
			WHEN TRIM(D1.D1_FILIAL) = '03' THEN 'PR'
			WHEN TRIM(D1.D1_FILIAL) = '04' THEN 'SC'
			ELSE 'XX' END) AS COD_FILIAL,
       D2.D2_COD AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       D1.D1_CF AS DES_CFOP,
       D2.D2_PEDIDO AS NUM_PEDIDO,
       (
		CASE WHEN C5.C5_PROPRI =  '4' THEN 'VENDEDOR'
			ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       CASE
         WHEN D1.D1_DTDIGIT > ' ' THEN D1.D1_DTDIGIT
         ELSE '00010101' END AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       F2.F2_DOC AS NUM_NF,
       F2.F2_VEND1 AS COD_VEND_NF,
       CONCAT(F2.F2_VEND1 , '-' , A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN , '-' , A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER , '-' , A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN , '-' , A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER , '-' , A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       CONCAT(A33.A3_GEREN , '-' , A311.A3_NREDUZ) AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER , '-' , A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,
       NULL AS QTD_CLI_FATURADO,
       0 AS QTD_FATURADO,
       0 AS QTD_LITROS_FATURADO,
       D2.D2_PRUNIT AS VLR_TABELA,
       0 AS VLR_FATURADO,
       0 AS VLR_TOT_FATURADO,
       D1.D1_QUANT * -1 AS QTD_BONIFICADO,
       D1.D1_QUANT * B1.B1_QTELITS * -1 AS QTD_LITROS_BONIFICADO,
       (D1.D1_TOTAL - D1.D1_VALDESC) * -1 AS VLR_TOT_BONIFICADO,
       0 AS QTD_DEVOLVIDO,
       0 AS QTD_LITROS_DEVOLVIDO,
       0 AS VLR_TOT_DEVOLVIDO,
       0 AS VLR_MARGEM,
       0 AS VLR_MARGEM_PROD,
       0 AS VLR_MARGEM_PERC,
       D2.D2_VALPROM / D2_QUANT * D1_QUANT * -1 AS VLR_TAMPA,
       D2.D2_XVALPAG / D2_QUANT * D1_QUANT * -1 AS VLR_FI,
      (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1  
          THEN D2.D2_XCUSTO / D2.D2_QUANT * D1.D1_QUANT 
        ELSE D2.D2_CUSTO1 / D2.D2_QUANT * D1_QUANT 
      END + 
      ( D2.D2_VALBRUT / D2.D2_QUANT * D1.D1_QUANT * 6.5 / 100 )) * -1 AS VLR_CMV,
	     D2.D2_VALIMP6 / D2_QUANT * D1_QUANT * -1 AS VLR_PIS,
       D2.D2_VALIMP5 / D2_QUANT * D1_QUANT * -1 AS VLR_COFINS,
       D2.D2_VALICM / D2_QUANT * D1_QUANT * -1 AS VLR_ICM,
       0 AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       0 AS VLR_VENDIDO,
       0 AS QTD_VENDIDO,
       0 AS QTD_LITROS_VENDIDO,
       0 AS VLR_RESIDUO,
       0 AS QTD_RESIDUO,
       0 AS QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       0 AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
       0 AS QTD_LITROS_VEND_DIA,
       0 AS VLR_VEND_DIA,
       0 AS VLR_PENDENTE,
       0 AS QTD_PENDENTE,
       0 AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SD1140 D1

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF2140 F2
    ON F2.F2_LOJA = D1.D1_LOJA
   AND F2.F2_CLIENTE = D1.D1_FORNECE
   AND F2.F2_DOC = D1.D1_NFORI
   AND F2.F2_SERIE = D1.D1_SERIORI
   AND F2.F2_FILIAL = D1.D1_FILIAL
   AND F2.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SD2140 D2
    ON D2.D2_ITEM = D1.D1_ITEMORI
   AND D2.D2_COD = D1.D1_COD
   AND D2.D2_LOJA = D1.D1_LOJA
   AND D2.D2_CLIENTE = D1.D1_FORNECE
   AND D2.D2_DOC = D1.D1_NFORI
   AND D2.D2_SERIE = D1.D1_SERIORI
   AND D2.D2_FILIAL = D1.D1_FILIAL
   AND D2.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_LOJA = D1.D1_LOJA
   AND A1.A1_COD = D1.D1_FORNECE
   AND A1.A1_FILIAL = '  '
   AND A1.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = D1.D1_COD
   AND B1.B1_FILIAL = D1.D1_FILIAL
   AND B1.D_E_L_E_T_ = ' '

  INNER JOIN C8O7DN_135098_PR_PD.dbo.SC5140 C5
    ON C5.C5_NUM = D2.D2_PEDIDO
   AND C5.C5_FILIAL = D2.D2_FILIAL
   AND C5.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'N'
   AND F4_ESTOQUE = 'S'
   AND F4.F4_XTPMOV NOT IN
       ('BA', 'VS', 'TF', 'RT', 'TA', 'RC', 'RA', 'SP', 'TE')
   AND F4.F4_CODIGO = D1.D1_TES
   AND F4.F4_FILIAL = D1.D1_FILIAL
   AND F4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = F2.F2_COND
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = F2.F2_VEND1
   AND A34.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A311
    ON A311.A3_FILIAL = ' '
   AND A311.A3_COD = A33.A3_GEREN
   AND A311.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_ = ' '

 
  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''


 WHERE D1_FILIAL IN ('01','02','03','04')
    AND D1_DTDIGIT >=  convert(varchar, GETDATE()-731, 112) 
    AND D1_TIPO = 'D'
    AND D1.D_E_L_E_T_ = ' '

UNION ALL


   SELECT
       'DEVOLUCAO_FATURAMENTO' AS DES_TIPO,
       F2.F2_CLIENTE AS COD_CLIENTE,
       F2.F2_LOJA AS COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       (CASE
         WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC
         ELSE '00010101' END) AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 ,  '-' ,  ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGMENTO,
       CONCAT(A1.A1_SATIV3 ,  '-' ,  ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 ,  '-' ,  ISNULL((SELECT  DISTINCT  (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 ,  '-' ,  ISNULL((SELECT  DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
       CONCAT(A1.A1_GRPVEN ,  '-' ,  ISNULL((SELECT  DISTINCT (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD ,  A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
       CONCAT(A1.A1_VEND ,  '-' ,  A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 ,  '-' ,  A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 ,  '-' ,  A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN ,  '-' ,  A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER ,  '-' ,  A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT DISTINCT  X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = D2.D2_FILIAL AND X5.D_E_L_E_T_  = ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD ,  A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,
       (CASE	WHEN TRIM(F2.F2_FILIAL) = '01' THEN 'RS'
				WHEN TRIM(F2.F2_FILIAL) = '02' THEN 'MG'
				WHEN TRIM(F2.F2_FILIAL) = '03' THEN 'PR'
				WHEN TRIM(F2.F2_FILIAL) = '04' THEN 'SC'
				ELSE 'XX' END) AS COD_FILIAL,
       D2.D2_COD AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       D1.D1_CF AS DES_CFOP,
       D2.D2_PEDIDO AS NUM_PEDIDO,
       (CASE WHEN C5.C5_PROPRI = '4' THEN 'VENDEDOR'
			ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       (CASE
         WHEN D1.D1_DTDIGIT > ' ' THEN D1.D1_DTDIGIT
         ELSE '00010101' END) AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       F2.F2_DOC AS NUM_NF,
       F2.F2_VEND1 AS COD_VEND_NF,
       CONCAT(F2.F2_VEND1 ,  '-' ,  A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN ,  '-' ,  A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER ,  '-' ,  A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN ,  '-' ,  A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER ,  '-' ,  A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       CONCAT(A33.A3_GEREN ,  '-' ,  A311.A3_NREDUZ) AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER ,  '-' ,  A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,
       NULL AS QTD_CLI_FATURADO,
       0 AS QTD_FATURADO,
       0 AS QTD_LITROS_FATURADO,
       D2.D2_PRUNIT AS VLR_TABELA,
       0 AS VLR_FATURADO,
       0 AS VLR_TOT_FATURADO,
       0 AS QTD_BONIFICADO,
       0 AS QTD_LITROS_BONIFICADO,
       0 AS VLR_TOT_BONIFICADO,
       D1.D1_QUANT AS QTD_DEVOLVIDO,
       D1.D1_QUANT * B1.B1_QTELITS AS QTD_LITROS_DEVOLVIDO,
       D1.D1_TOTAL - D1.D1_VALDESC AS VLR_TOT_DEVOLVIDO,
       (((D2.D2_TOTAL - D2.D2_VALPROM - D2.D2_VALIMP6 -
       D2.D2_VALIMP5 - 
      (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1  
          THEN D2.D2_XCUSTO
        ELSE D2.D2_CUSTO1
      END + (D2.D2_VALBRUT * 6.5 / 100)) - 
      D2.D2_XVALPAG - D2.D2_DIFAL -
       D2_VALICM - D2_ICMSCOM) / D2.D2_QUANT) * D1.D1_QUANT) * -1 AS VLR_MARGEM,
       ((((D2.D2_VALBRUT - D2.D2_VALPROM - D2.D2_VALIMP6 -
       D2.D2_VALIMP5 - 
      (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1  
          THEN D2.D2_XCUSTO
        ELSE D2.D2_CUSTO1 
      END + (D2.D2_VALBRUT * 6.5 / 100)) - 
      D2.D2_XVALPAG - D2.D2_DIFAL -
      D2_VALICM - D2_ICMSCOM) / D2.D2_QUANT) * D1.D1_QUANT) *
      B1.B1_PRMINFO / 100) * -1 AS VLR_MARGEM_PROD,
      0 AS VLR_MARGEM_PERC,
      D2.D2_VALPROM / D2_QUANT * D1_QUANT * -1 AS VLR_TAMPA,
      D2.D2_XVALPAG / D2_QUANT * D1_QUANT * -1 AS VLR_FI, 
  	  (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1 
          THEN D2.D2_XCUSTO / D2_QUANT * D1_QUANT
	      ELSE D2.D2_CUSTO1 / D2_QUANT * D1_QUANT 
      END + (D2.D2_VALBRUT / D2.D2_QUANT * D1.D1_QUANT * 6.5 / 100)) * -1 AS VLR_CMV,
	     D2.D2_VALIMP6 / D2_QUANT * D1_QUANT * -1 AS VLR_PIS,
       D2.D2_VALIMP5 / D2_QUANT * D1_QUANT * -1 AS VLR_COFINS,
       D2.D2_VALICM / D2_QUANT * D1_QUANT * -1 AS VLR_ICM,
       (D2.D2_TOTAL * E4.E4_PRZMEDI) * -1 AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       0 AS VLR_VENDIDO,
       0 AS QTD_VENDIDO,
       0 AS QTD_LITROS_VENDIDO,
       0 AS VLR_RESIDUO,
       0 AS QTD_RESIDUO,
       0 AS QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       CASE
         WHEN TRIM(B1.B1_GRUPO) = 'SN' THEN
          (D1.D1_QUANT * B1.B1_QTELITS) * -1
         ELSE
          0
       END AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
       0 AS QTD_LITROS_VEND_DIA,
       0 AS VLR_VEND_DIA,
       0 AS VLR_PENDENTE,
       0 AS QTD_PENDENTE,
       0 AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SD1140 D1

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF2140 F2
    ON F2.F2_LOJA = D1.D1_LOJA
   AND F2.F2_CLIENTE = D1.D1_FORNECE
   AND F2.F2_DOC = D1.D1_NFORI
   AND F2.F2_SERIE = D1.D1_SERIORI
   AND F2.F2_FILIAL = D1.D1_FILIAL
   AND F2.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SD2140 D2
    ON D2.D2_ITEM = D1.D1_ITEMORI
   AND D2.D2_COD = D1.D1_COD
   AND D2.D2_LOJA = D1.D1_LOJA
   AND D2.D2_CLIENTE = D1.D1_FORNECE
   AND D2.D2_DOC = D1.D1_NFORI
   AND D2.D2_SERIE = D1.D1_SERIORI
   AND D2.D2_FILIAL = D1.D1_FILIAL
   AND D2.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_LOJA = D1.D1_LOJA
   AND A1.A1_COD = D1.D1_FORNECE
   AND A1.A1_FILIAL = '  '
   AND A1.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = D1.D1_COD
   AND B1.B1_FILIAL = D1.D1_FILIAL
   AND B1.D_E_L_E_T_ = ' '

  INNER JOIN C8O7DN_135098_PR_PD.dbo.SC5140 C5
    ON C5.C5_NUM = D2.D2_PEDIDO
   AND C5.C5_FILIAL = D2.D2_FILIAL
   AND C5.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'S'
   AND F4.F4_ESTOQUE = 'S'
   AND F4.F4_XTPMOV NOT IN
       ('BA', 'VS', 'TF', 'RT', 'TA', 'RC', 'RA', 'SP', 'TE')
   AND F4.F4_CODIGO = D1.D1_TES
   AND F4.F4_FILIAL = D1.D1_FILIAL
   AND F4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = F2.F2_COND
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = F2.F2_VEND1
   AND A34.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR
   AND A3ASUP.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A311
    ON A311.A3_FILIAL = ' '
   AND A311.A3_COD = A33.A3_GEREN
   AND A311.D_E_L_E_T_ = ' ' 

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''

 WHERE D1_FILIAL IN ('01','02','03','04')
    AND D1_DTDIGIT >= convert(varchar, GETDATE()-1095, 112) 
    AND D1_TIPO = 'D'
    AND D1.D_E_L_E_T_ = ' '

UNION ALL


    SELECT 
       'FATURAMENTO' AS DES_TIPO,
       A1.A1_COD AS COD_CLIENTE,
       A1.A1_LOJA AS COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       CASE
         WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC
         ELSE '00010101' END AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_ = ' '),
                                  ' ')) AS DES_SEGMENTO,
       CONCAT(A1.A1_SATIV3 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_ = ' '),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_ = ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL AND X5.D_E_L_E_T_ = ' '),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
       CONCAT(A1.A1_GRPVEN , '-' , ISNULL((SELECT DISTINCT (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD , A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
       CONCAT(A1.A1_VEND , '-' , A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 , '-' , A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 , '-' , A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN , '-' , A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER , '-' , A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT DISTINCT X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = D2.D2_FILIAL AND X5.D_E_L_E_T_ = ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD , A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,       
       (CASE 
			WHEN TRIM(F2.F2_FILIAL) = '01' THEN 'RS'
			WHEN TRIM(F2.F2_FILIAL) = '02' THEN 'MG'
			WHEN TRIM(F2.F2_FILIAL) = '03' THEN 'PR'
			WHEN TRIM(F2.F2_FILIAL) = '04' THEN 'SC'
			ELSE 'XX' END) AS COD_FILIAL,
       D2.D2_COD AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       D2.D2_CF AS DES_CFOP,
       D2.D2_PEDIDO AS NUM_PEDIDO,
       (CASE WHEN C5.C5_PROPRI = '4' THEN 'VENDEDOR'
			ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       CASE
         WHEN F2.F2_EMISSAO > ' ' THEN F2.F2_EMISSAO
         ELSE '00010101' END AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       F2.F2_DOC AS NUM_NF,
       F2.F2_VEND1 AS COD_VEND_NF,
       CONCAT(F2.F2_VEND1 , '-' , A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN , '-' , A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER , '-' , A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN , '-' , A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER , '-' , A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       CONCAT(A33.A3_GEREN , '-' , A311.A3_NREDUZ) AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER , '-' , A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,

       CASE
         WHEN D2.D2_TOTAL > 0 THEN
          CONCAT(A1.A1_COD , A1.A1_LOJA)
         ELSE
          NULL
       END AS QTD_CLI_FATURADO,
       D2.D2_QUANT AS QTD_FATURADO,
       D2.D2_QUANT * B1.B1_QTELITS AS QTD_LITROS_FATURADO,
       D2.D2_PRUNIT AS VLR_TABELA,
       D2.D2_TOTAL / D2.D2_QUANT AS VLR_FATURADO,
       D2.D2_TOTAL AS VLR_TOT_FATURADO,
       0 AS QTD_BONIFICADO,
       0 AS QTD_LITROS_BONIFICADO,
       0 AS VLR_TOT_BONIFICADO,
       0 AS QTD_DEVOLVIDO,
       0 AS QTD_LITROS_DEVOLVIDO,
       0 AS VLR_TOT_DEVOLVIDO,
       (D2.D2_TOTAL - D2.D2_VALPROM - D2.D2_VALIMP6 -
       D2.D2_VALIMP5 - 
	    (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1 
          THEN D2.D2_XCUSTO
	      ELSE D2.D2_CUSTO1
      END + (D2.D2_VALBRUT * 6.5 / 100 )) - 
      D2.D2_XVALPAG - 
      D2.D2_DIFAL -
      D2.D2_VALICM - D2.D2_ICMSCOM) AS VLR_MARGEM,
      D2.D2_VALBRUT * B1.B1_PRMINFO / 100 AS VLR_MARGEM_PROD,
      0 AS VLR_MARGEM_PERC,
      D2.D2_VALPROM AS VLR_TAMPA,
      D2.D2_XVALPAG AS VLR_FI,
	    (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1 
          THEN D2.D2_XCUSTO
	      ELSE D2.D2_CUSTO1 
      END + (D2.D2_VALBRUT * 6.5 / 100)) AS VLR_CMV,
       D2.D2_VALIMP6 AS VLR_PIS,
       D2.D2_VALIMP5 AS VLR_COFINS,
       D2.D2_VALICM AS VLR_ICM,
       (D2.D2_TOTAL * E4.E4_PRZMEDI) AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       0 AS VLR_VENDIDO,
       0 AS QTD_VENDIDO,
       0 AS QTD_LITROS_VENDIDO,
       0 AS VLR_RESIDUO,
       0 AS QTD_RESIDUO,
       0 AS QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       CASE
         WHEN TRIM(B1.B1_GRUPO) = 'SN' THEN
          D2.D2_QUANT * B1.B1_QTELITS
         ELSE
          0
       END AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
       0 AS QTD_LITROS_VEND_DIA,
       0 AS VLR_VEND_DIA,
       0 AS VLR_PENDENTE,
       0 AS QTD_PENDENTE,
       0 AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SF2140 F2

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SD2140 D2
    ON D2.D2_SERIE = F2.F2_SERIE
   AND D2.D2_DOC = F2.F2_DOC
   AND D2.D2_FILIAL = F2.F2_FILIAL
   AND D2.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_LOJA = F2.F2_LOJA
   AND A1.A1_COD = F2.F2_CLIENTE
   AND A1.A1_FILIAL = '  '
   AND A1.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = D2.D2_COD
   AND B1.B1_FILIAL = D2.D2_FILIAL
   AND B1.D_E_L_E_T_ = ' '

  INNER JOIN C8O7DN_135098_PR_PD.dbo.SC5140 C5
    ON C5.C5_NUM = D2.D2_PEDIDO
   AND C5.C5_FILIAL = D2.D2_FILIAL
   AND C5.D_E_L_E_T_ = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'S'
   AND F4.F4_ESTOQUE = 'S'
   AND F4.F4_CODIGO = D2.D2_TES
   AND F4.F4_FILIAL = D2.D2_FILIAL
   AND F4.F4_XTPMOV NOT IN
       ('BA', 'VS', 'TF', 'RT', 'TA', 'RC', 'RA', 'SP', 'TE')
   AND F4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = F2.F2_COND
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = F2.F2_VEND1
   AND A34.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR
   AND A3ASUP.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A311
    ON A311.A3_FILIAL = ' '
   AND A311.A3_COD = A33.A3_GEREN
   AND A311.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_ = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''

 WHERE TRIM(F2.F2_FILIAL) IN ('01','02','03','04')
    AND F2.F2_TIPO = 'N'
    AND F2.F2_EMISSAO >= convert(varchar, GETDATE()-1095, 112)
    AND F2.D_E_L_E_T_ = ' '

UNION ALL

 
 SELECT 
       'BONIFICACAO' AS DES_TIPO,
       F2.F2_CLIENTE COD_CLIENTE,
       F2.F2_LOJA COD_LOJA,
       A1.A1_NOME AS DES_CLIENTE,
       A1.A1_CGC AS NUM_CNPJ,
       A1.A1_RISCO AS DES_RISCO,
       A1.A1_LC AS VLR_LIMITE_CRED,
       (CASE
         WHEN A1.A1_VENCLC > ' ' THEN A1.A1_VENCLC 
		 ELSE '00010101' END) AS DAT_LIM_CRED,
       CONCAT(A1.A1_SATIV1 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV1
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL
                                     AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGMENTO,
       CONCAT(A1.A1_SATIV3 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV3
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL
                                      AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_REDE,
       CONCAT(A1.A1_SATIV4 , '-' , ISNULL((SELECT DISTINCT (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV4
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL
                                      AND X5.D_E_L_E_T_  = ' '),
                                  ' ')) AS DES_SEGM_GRUPO,
       CONCAT(A1.A1_SATIV5 , '-' , ISNULL((SELECT TOP 1 (X5.X5_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
                                   WHERE X5.X5_CHAVE = A1.A1_SATIV5
                                     AND X5.X5_TABELA = 'T3'
                                     AND X5.X5_FILIAL = F2.F2_FILIAL
                                     ),
                                  ' ')) AS DES_SEGM_SUBGRUPO,
								  
       CONCAT(A1.A1_GRPVEN , '-' , ISNULL((SELECT (ACY.ACY_DESCRI)
                                    FROM C8O7DN_135098_PR_PD.dbo.ACY140 ACY
                                   WHERE ACY.ACY_GRPVEN = A1.A1_GRPVEN
                                     AND ACY.ACY_FILIAL = ' '
                                     ),
                                  ' ')) AS DES_GRA,
       A1.A1_EST AS DES_UF,
       A1.A1_MUN AS DES_CIDADE,
       A1.A1_CEP AS NUM_CEP,
       A1.A1_BAIRRO AS DES_BAIRRO,
       A1.A1_END AS DES_ENDERECO,
       CONCAT(A1.A1_DDD , A1_TEL) AS NUM_TELEFONE,
       ' ' AS DES_RAMACCE,
       A1.A1_EMAIL AS DES_EMAIL,
       A1.A1_VEND AS COD_VEND1_CLIENTE,
       CONCAT(A1.A1_VEND , '-' , A3.A3_NREDUZ) AS DES_VEND1_CLIENTE,
       A1.A1_VEND2 AS COD_VEND2_CLIENTE,
       CONCAT(A1.A1_VEND2 , '-' , A32.A3_NREDUZ) AS DES_VEND2_CLIENTE,
       A1.A1_VEND3 AS COD_VEND3_CLIENTE,
       CONCAT(A1.A1_VEND3 , '-' , A33.A3_NREDUZ) AS DES_VEND3_CLIENTE,
       A34.A3_GEREN AS COD_GERENTE_NF,
       CONCAT(A34.A3_GEREN , '-' , A35.A3_NREDUZ) AS DES_GERENTE_NF,
       A34.A3_SUPER AS COD_SUPERV_NF,
       CONCAT(A34.A3_SUPER , '-' , A36.A3_NREDUZ) AS DES_SUPERV_NF,
       A34.A3_ACESSOR AS COD_ASSESSOR,
       A3ASUP.A3_SUPER AS COD_ASSESSOR_SUPERV,
       A313.A3_NOME AS DES_ASSESSOR,
       ISNULL((SELECT DISTINCT X5.X5_DESCRI
             FROM C8O7DN_135098_PR_PD.dbo.SX5140 X5
            WHERE X5.X5_CHAVE = A1.A1_REGIAO
              AND X5.X5_TABELA = 'A2'
              AND X5.X5_FILIAL = D2.D2_FILIAL
               AND X5.D_E_L_E_T_  = ' '),
           ' ') AS DES_REGIAO,
       ISNULL((SELECT MAX(SU5.U5_EMAIL)
             FROM C8O7DN_135098_PR_PD.dbo.AC8140 AC8, C8O7DN_135098_PR_PD.dbo.SU5140 SU5
            WHERE SU5.U5_CODCONT = AC8.AC8_CODCON
              AND SU5.U5_FILIAL = ' '
              AND AC8.AC8_ENTIDA = 'SA1'
              AND AC8.AC8_CODENT = CONCAT(A1.A1_COD , A1.A1_LOJA)
              AND AC8.AC8_FILIAL = ' '),
           ' ') AS DES_EMAIL_CONTATO,
       (CASE WHEN
			F2.F2_FILIAL = '01' THEN 'RS'
			WHEN F2.F2_FILIAL = '02' THEN 'MG'
			WHEN F2.F2_FILIAL = '03' THEN 'PR'
			WHEN F2.F2_FILIAL = '04' THEN 'SC'
			ELSE 'XX' END) AS COD_FILIAL,
       D2.D2_COD AS COD_PRODUTO,
       B1.B1_DESC AS DES_PRODUTO,
       B1.B1_GRUPO AS DES_GRUPOPRODUTO,
       D2.D2_CF AS DES_CFOP,
       D2.D2_PEDIDO AS NUM_PEDIDO,
	   (CASE WHEN 
			C5.C5_PROPRI = '4' THEN 'VENDEDOR'
			ELSE 'ASSESSORA' END) AS DES_ORIGEM_PEDIDO,
       CASE
         WHEN F2.F2_EMISSAO > ' ' THEN
          F2.F2_EMISSAO
         ELSE
          '00010101'
       END AS DAT_REF,
       MARCAS.X5_DESCRI AS DES_SEGM_VENDA,
       F2.F2_DOC AS NUM_NF,
       F2.F2_VEND1 AS COD_VEND_NF,
       CONCAT(F2.F2_VEND1 , '-' , A34.A3_NREDUZ) AS DES_VEND_NF,
       A3.A3_GEREN AS COD_GERENTE_VEND1_CLIENTE,
       CONCAT(A3.A3_GEREN , '-' , A37.A3_NREDUZ) AS DES_GERENTE_VEND1_CLIENTE,
       A3.A3_SUPER AS COD_SUPERV_VEND1_CLIENTE,
       CONCAT(A3.A3_SUPER , '-' , A38.A3_NREDUZ) AS DES_SUPERV_VEND1_CLIENTE,
       A32.A3_GEREN AS COD_GERENTE_VEND2_CLIENTE,
       CONCAT(A32.A3_GEREN , '-' , A39.A3_NREDUZ) AS DES_GERENTE_VEND2_CLIENTE,
       A32.A3_SUPER AS COD_SUPERV_VEND2_CLIENTE,
       CONCAT(A32.A3_SUPER , '-' , A310.A3_NREDUZ) AS DES_SUPERV_VEND2_CLIENTE,
       A33.A3_GEREN AS COD_GERENTE_VEND3_CLIENTE,
       '' AS DES_GERENTE_VEND3_CLIENTE,
       A33.A3_SUPER AS COD_SUPERV_VEND3_CLIENTE,
       CONCAT(A33.A3_SUPER , '-' , A312.A3_NREDUZ) AS DES_SUPERV_VEND3_CLIENTE,
       NULL AS QTD_CLI_FATURADO,
       0 AS QTD_FATURADO,
       0 AS QTD_LITROS_FATURADO,
       D2.D2_PRUNIT AS VLR_TABELA,
       0 AS VLR_FATURADO,
       0 AS VLR_TOT_FATURADO,
       D2.D2_QUANT AS QTD_BONIFICADO,
       D2.D2_QUANT * B1.B1_QTELITS AS QTD_LITROS_BONIFICADO,
       D2.D2_TOTAL AS VLR_TOT_BONIFICADO,
       0 AS QTD_DEVOLVIDO,
       0 AS QTD_LITROS_DEVOLVIDO,
       0 AS VLR_TOT_DEVOLVIDO,
      ((CASE
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1
          THEN D2.D2_XCUSTO
        ELSE D2.D2_CUSTO1 
      END + (D2.D2_VALBRUT * 6.5 / 100 )) + 
      D2.D2_VALICM + D2.D2_VALIMP5 + D2.D2_VALIMP6) * -1 AS VLR_MARGEM,
      0 AS VLR_MARGEM_PROD,
      0 AS VLR_MARGEM_PERC,
      D2.D2_VALPROM AS VLR_TAMPA,
      D2.D2_XVALPAG AS VLR_FI,
	    (CASE 
        WHEN D2.D2_XCUSTO > D2.D2_CUSTO1 
          THEN D2.D2_XCUSTO 
        ELSE D2.D2_CUSTO1 
      END + (D2.D2_VALBRUT * 6.5 / 100 )) AS VLR_CMV,
       D2.D2_VALIMP6 AS VLR_PIS,
       D2.D2_VALIMP5 AS VLR_COFINS,
       D2.D2_VALICM AS VLR_ICM,
       0 AS NUM_PRAZO_MEDIO,
       0 AS VLR_CMV_MICHELIN,
       0 AS VLR_VENDIDO,
       0 AS QTD_VENDIDO,
       0 AS QTD_LITROS_VENDIDO,
       0 AS VLR_RESIDUO,
	   0 AS QTD_RESIDUO,
	   0 AS QTD_LITROS_RESIDUO,
       0 AS QTD_META,
       0 AS VLR_META,
       0 AS VLR_META_ESP,
       0 AS QTD_LITROS_SN,
       0 AS VLR_META_SN,
	   0 AS QTD_LITROS_VEND_DIA,
	   0 AS VLR_VEND_DIA,
       0 AS VLR_PENDENTE,
       0 AS QTD_PENDENTE,
       0 AS QTD_LITROS_PENDENTE,
       0 AS VLR_BROKER,
       0 AS QTD_LITROS_BROKER

  FROM C8O7DN_135098_PR_PD.dbo.SF2140 F2

 LEFT JOIN C8O7DN_135098_PR_PD.dbo.SD2140 D2
    ON D2.D2_SERIE = F2.F2_SERIE
   AND D2.D2_DOC = F2.F2_DOC
   AND D2.D2_FILIAL = F2.F2_FILIAL
   AND D2.D_E_L_E_T_  = ' '

 LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA1140 A1
    ON A1.A1_LOJA = F2.F2_LOJA
   AND A1.A1_COD = F2.F2_CLIENTE
   AND A1.A1_FILIAL = '  '
   AND A1.D_E_L_E_T_  = ' '

 LEFT JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_COD = D2.D2_COD
   AND B1.B1_FILIAL = D2.D2_FILIAL
   AND B1.D_E_L_E_T_  = ' '
   

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SC5140 C5
    ON C5.C5_NUM = D2.D2_PEDIDO
   AND C5.C5_FILIAL = D2.D2_FILIAL
							   
   AND C5.D_E_L_E_T_  = ' '

 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_DUPLIC = 'N'
   AND F4.F4_ESTOQUE = 'S'
   AND F4.F4_CF NOT IN ('5926', '6152', '6659', '5949') 
   AND F4.F4_XTPMOV NOT IN
       ('BA', 'VS', 'TF', 'RT', 'TA', 'RC', 'RA', 'SP', 'TE')
   AND F4.F4_CODIGO = D2.D2_TES
								
   AND F4.F4_FILIAL = D2.D2_FILIAL
   AND F4.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SE4140 E4
    ON E4.E4_CODIGO = F2.F2_COND
   AND E4.E4_FILIAL = ' '
   AND E4.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3
    ON A3.A3_FILIAL = ' '
   AND A3.A3_COD = A1.A1_VEND
   AND A3.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A32
    ON A32.A3_FILIAL = ' '
   AND A32.A3_COD = A1.A1_VEND2
   AND A32.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A33
    ON A33.A3_FILIAL = ' '
   AND A33.A3_COD = A1.A1_VEND3
   AND A33.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A34
    ON A34.A3_FILIAL = ' '
   AND A34.A3_COD = F2.F2_VEND1
   AND A34.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A3ASUP
    ON A3ASUP.A3_FILIAL = ' '
   AND A3ASUP.A3_COD = A34.A3_ACESSOR
   AND A3ASUP.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A35
    ON A35.A3_FILIAL = ' '
   AND A35.A3_COD = A34.A3_GEREN
   AND A35.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A36
    ON A36.A3_FILIAL = ' '
   AND A36.A3_COD = A34.A3_SUPER
   AND A36.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A37
    ON A37.A3_FILIAL = ' '
   AND A37.A3_COD = A3.A3_GEREN
   AND A37.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A38
    ON A38.A3_FILIAL = ' '
   AND A38.A3_COD = A3.A3_SUPER
   AND A38.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A39
    ON A39.A3_FILIAL = ' '
   AND A39.A3_COD = A32.A3_GEREN
   AND A39.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A310
    ON A310.A3_FILIAL = ' '
   AND A310.A3_COD = A32.A3_SUPER
   AND A310.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A314
    ON A314.A3_FILIAL = ' '
   AND A314.A3_COD = A33.A3_GEREN
							

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A312
    ON A312.A3_FILIAL = ' '
   AND A312.A3_COD = A33.A3_SUPER
   AND A312.D_E_L_E_T_  = ' '

  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SA3140 A313
    ON A313.A3_FILIAL = ' '
   AND A313.A3_COD = A34.A3_ACESSOR
   AND A313.D_E_L_E_T_  = ' '
	
  LEFT JOIN C8O7DN_135098_PR_PD.dbo.SX5140 MARCAS
  ON MARCAS.X5_TABELA = 'ZY' AND MARCAS.X5_CHAVE = TRIM(B1.B1_CABO) AND MARCAS.D_E_L_E_T_ = ''
 

 WHERE TRIM(F2.F2_FILIAL) IN ('01','02','03','04')
    AND F2.F2_TIPO = 'N'
    AND F2.F2_EMISSAO >= convert(varchar, GETDATE()-1095, 112)
    AND F2.D_E_L_E_T_  = ' '