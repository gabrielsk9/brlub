
 
  SELECT
    D1.D1_FILIAL AS FILIAL,
    D1.D1_TIPO AS TIPO,
    D1.D1_DOC AS NF,
    D1.D1_SERIE AS SERIE,
    D1.D1_EMISSAO AS DTEMISSAO,
    D1.D1_DTDIGIT AS DTDIGIT,
    D1.D1_COD AS CODIGO,
    B1.B1_DESC AS DESCRI,
    D1.D1_QUANT AS QTD,
    D1.D1_QUANT * B1.B1_QTELITS AS LITROS,
    ROUND(		D1.D1_CUSTO / 
				(CASE WHEN D1.D1_QUANT = 0 THEN 1 ELSE D1.D1_QUANT END)
	, 2) AS UNIT,
    D1.D1_CUSTO AS TOTAL,
    B1.B1_PROC AS FORNECEDOR,
    B1.B1_CABO AS SEGMENTO
  FROM C8O7DN_135098_PR_PD.dbo.SD1140 D1
 INNER JOIN C8O7DN_135098_PR_PD.dbo.SB1140 B1
    ON B1.B1_FILIAL = D1.D1_FILIAL
   AND B1.B1_COD = D1.D1_COD
   AND B1.D_E_L_E_T_ = ' '
 INNER JOIN C8O7DN_135098_PR_PD.dbo.SF4140 F4
    ON F4.F4_FILIAL = D1.D1_FILIAL
   AND F4.F4_CODIGO = D1.D1_TES
   AND F4.F4_ESTOQUE = 'S'
   AND F4.D_E_L_E_T_ = ' '
 WHERE D1.D1_DTDIGIT >= convert(varchar, GETDATE()-731, 112)  
   AND D1.D_E_L_E_T_ = ' '

